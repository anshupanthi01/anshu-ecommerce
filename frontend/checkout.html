<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Glam</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav id="navbar" class="navbar"></nav>

    <div class="container">
        <div class="auth-container" style="max-width: 600px;">
            <h2>Checkout ðŸ’³</h2>
            <div id="order-summary" style="margin-bottom: 2rem; text-align: left; background: rgba(255,255,255,0.5); padding: 1rem; border-radius: 10px;">
                <!-- Summary loaded here -->
            </div>

            <form id="checkout-form">
                <div class="form-group">
                    <label>Shipping Address</label>
                    <input type="text" id="address" required placeholder="123 Pink St, Dream City">
                </div>
                <!-- Payment details would go here in a real app -->
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Place Order</button>
            </form>
        </div>
    </div>

    <div id="footer-container"></div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Load footer
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });

        async function initCheckout() {
            auth.checkAuth();
            try {
                const cartData = await cart.get();
                const summaryDiv = document.getElementById('order-summary');
                
                if (!cartData || !cartData.items || cartData.items.length === 0) {
                    alert('Cart is empty!');
                    window.location.href = 'index.html';
                    return;
                }

                summaryDiv.innerHTML = `
                    <p><strong>Total Items:</strong> ${cartData.items.reduce((acc, item) => acc + item.quantity, 0)}</p>
                    <p><strong>Total Amount:</strong> ${ui.formatPrice(cartData.total_amount)}</p>
                `;
            } catch (error) {
                console.error("Error loading checkout:", error);
            }
        }

        document.getElementById('checkout-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            
            try {
                btn.textContent = 'Processing...';
                btn.disabled = true;

                // Create order via API
                await api.post('/api/orders/', {
                    shipping_address: document.getElementById('address').value
                });

                ui.showToast('Order placed successfully! ðŸŽ‰', 'success');
                
                // Clear cart locally if needed, but backend usually handles it
                // await cart.clear(); 

                setTimeout(() => {
                    window.location.href = 'orders.html';
                }, 2000);

            } catch (error) {
                ui.showToast(error.message, 'error');
                btn.textContent = 'Place Order';
                btn.disabled = false;
            }
        });

        document.addEventListener('DOMContentLoaded', initCheckout);
    </script>
</body>
</html>