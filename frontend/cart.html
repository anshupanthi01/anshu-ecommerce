<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - Glam</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav id="navbar" class="navbar"></nav>

    <div class="container">
        <h1 style="margin-bottom: 2rem; color: var(--dark-pink);">Your Shopping Cart üõçÔ∏è</h1>
        
        <div class="cart-container">
            <div id="cart-items">
                <div style="text-align: center;">Loading cart...</div>
            </div>
            
            <div id="cart-summary" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #eee; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 style="font-size: 1.5rem;">Total:</h2>
                    <h2 style="font-size: 2rem; color: var(--primary-pink);" id="cart-total">$0.00</h2>
                </div>
                <div style="text-align: right;">
                    <button onclick="clearCart()" class="btn btn-secondary" style="margin-right: 1rem;">Clear Cart</button>
                    <button onclick="window.location.href='checkout.html'" class="btn btn-primary">Proceed to Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-container"></div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Load footer
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });

        async function loadCart() {
            auth.checkAuth();
            
            const container = document.getElementById('cart-items');
            const summaryDiv = document.getElementById('cart-summary');
            const totalEl = document.getElementById('cart-total');

            try {
                const cartData = await cart.get();
                
                if (!cartData || !cartData.items || cartData.items.length === 0) {
                    container.innerHTML = '<p style="text-align: center; font-size: 1.2rem;">Your cart is empty üçÉ</p>';
                    summaryDiv.style.display = 'none';
                    return;
                }

                container.innerHTML = cartData.items.map(item => `
                    <div class="cart-item">
                        <img src="${item.product.image_url ? 'http://localhost:8000' + item.product.image_url : 'https://via.placeholder.com/100?text=Product'}" alt="${item.product.name}">
                        <div class="cart-item-details">
                            <h3 style="font-size: 1.1rem; margin-bottom: 0.3rem;">${item.product.name}</h3>
                            <p style="color: #666;">${ui.formatPrice(item.product.price)}</p>
                        </div>
                        <div class="cart-item-actions">
                            <button class="quantity-btn" onclick="updateQty(${item.id}, ${item.quantity - 1})">-</button>
                            <span style="font-weight: 600; width: 30px; text-align: center;">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQty(${item.id}, ${item.quantity + 1})">+</button>
                            <span class="remove-btn" onclick="removeItem(${item.id})">üóëÔ∏è</span>
                        </div>
                    </div>
                `).join('');

                totalEl.textContent = ui.formatPrice(cartData.total_amount);
                summaryDiv.style.display = 'block';

            } catch (error) {
                container.innerHTML = `<p style="color: red; text-align: center;">Error: ${error.message}</p>`;
            }
        }

        async function updateQty(itemId, newQty) {
            if (newQty < 1) return;
            await cart.update(itemId, newQty);
            loadCart();
            ui.updateCartCount();
        }

        async function removeItem(itemId) {
            if (confirm('Are you sure you want to remove this item?')) {
                await cart.remove(itemId);
                loadCart();
                ui.updateCartCount();
            }
        }

        async function clearCart() {
            if (confirm('Are you sure you want to clear your cart?')) {
                await cart.clear();
                loadCart();
                ui.updateCartCount();
            }
        }

        document.addEventListener('DOMContentLoaded', loadCart);
    </script>
</body>
</html>